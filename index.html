<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Vulnerability Assessment Framework - Jordan </title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

         <!-- Theme style -->
        <link rel="stylesheet" type="text/css" href="css/vafTheme.css" />

        <!-- Bootstrap -->
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/dc.css"/>
        <link rel="stylesheet" type="text/css" href="css/3w-dashboard.css"/>
		
		<!-- Leaflet CSS -->
		<link type="text/css" href="inc/leaflet.css" rel="stylesheet"/>
		<link type="text/css" href="inc/leaflet.markercluster.css" rel="stylesheet"/>


        <!-- Add IntroJs styles and JS -->
        <link rel="stylesheet" type="text/css" href="css/introjs.min.css" >
        <script type="text/javascript" src="js/intro.min.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/intro.js"></script>
        <!-- map the data to the GeoJSON object -->
        <script src="js/data-jo.js"></script>
        <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">

    </head>
    <body class="skin-blue" onload="$('#Cmap').hide();">
<!-- header logo: style can be found in header.less -->

        <div id="dashboard">

            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
					<TABLE width=100%>
						<TR>
							<TD WIDTH= 30px>
							&nbsp;
							</TD>
							<TD>
							<h1><strong> <font color=#FFFFFF>  Vulnerability Assessment Framework (VAF) </font></strong></h1>
							<h3><strong> <font color=#FFFFFF>  Welfare distribution amongst urban refugees in Jordan </font> </strong></h3>
							</TD>
						</TR>
						<TR>
							<TD colspan=2>  <div id="AboutShow" style="text-align:right"> <a style="cursor:pointer; cursor:hand;" onclick="$('#About').show();$('#AboutHide').show();$('#AboutShow').hide();"><b> <font color=#FFFFFF> About this report </font></b> </a> </div> <div id="AboutHide" style="text-align:right"><a style="cursor:pointer; cursor:hand" onclick="$('#About').hide();$('#AboutHide').hide();$('#AboutShow').show();"> <b> <font color=#FFFFFF> About this report </font></b></a> </div> 
							</TD>
						</TR>
					</TABLE>
				

                </section>
                <section class="content-header" style="background-color:#FFFFFF;border-style: solid;border-color: #EAEAEA;border-width:1px;" id="About">
					<TABLE>
						<TR>
							<TD WIDTH= 120px>
							<IMG src="images/exclamation.png" WIDTH=100px>
							</TD>
							<TD>
<b> About this report: </b> This data visualization displays vulnerability profiles, calculated from a "welfare statistical model" and is based on information collected through Home Visit interviews with Syrian refugee households in Jordan throughout the second half of 2014, For a full explanation of the VAF statistical model used, please visit our dedicated portal page.
<br> <br>
<b> Data collection: </b> The methodology used to decide which cases were interviewed was not randomized. This could lead to some bias in the data, however An analysis of the bias vs sample confirmed that the sample used is satisfactory for analysis purposes at a national level. For analysis at the governorate and district levels, there may be further limitations in sample size.


							
							</TD>
						</TR>
					</TABLE>
				
                </section>
                <!-- Main content -->
                <section class="content">

                    <!-- Small boxes (Stat box) -->
                    <div class="row">
                        <div class="col-lg-3 col-xs-6">
                            <!-- small box -->
                            <div id="count-info" class="small-box bg-white" style="border-style: solid;border-color: #EAEAEA;border-width:1px;">
							<br>
							<p style="color:#000000">&nbsp;&nbsp; <b> Number of Cases: </b> <span class="filter-count"></span> of <strong><span class="total-count"></span></strong> </p>
							<p style="color:#000000">&nbsp;&nbsp; <b> Individuals: </b> <strong><span id="totalind" class="number-display"></span> </p>
							<br>
                            </div>
							<center> 
								<a class="reset btn btn-primary btn-sm"  href="javascript:dc.filterAll();dc.redrawAll();">Reset All</a> 
							</center>
                        </div><!-- ./col -->
                        <div class="col-lg-9 connectedSortable">
                            <!-- small box -->
                            <div class="small-box bg-aqua"  style="border-style: solid;border-color: #EAEAEA;border-width:1px;">
                                <span class="small-box-footer"style="color:#FFFFFF">
                                Distribution of cases across vulnerability ratings 
                                </span>
                                <div class="inner"  style="background-color: #FFFFFF !important;">
                                <div id="thresholds"> </div>
                                </div>
                            </div>
                        </div><!-- ./col -->
<!-- ./col -->
                    </div><!-- /.row -->

                    <!-- Main row -->
				
					<div class="row">
                        <!-- Left col -->
                        <section class="content-header">
                            <!-- Custom tabs (Charts with tabs)-->
                            <div class="nav-tabs-custom">
                                <!-- Tabs within a box -->
                                <ul class="nav nav-tabs pull-right">
                                    <li class="pull-left header"><i class="fa fa-inbox"></i> Geography</li>
                                </ul>


                                <div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->


															<h3 class="box-title">
																<H4><STRONG> <font color=#0F5B98> Geographic filter:<a href="javascript:HMapShow();"> Hex Binning</a> -or- <a href="javascript:CMapShow();">Cluster</a> </font></STRONG></H4>
															</h3>
														</div>
														<div class="box-body">
											<div id="holder" style="width: 100%; height:400px">
											<div id="Hmap" style="width: 100%; height:100%"></div>   
											<div id="Cmap" style="width: 100%; height:100%"></div>   
											</div>
														</div>
									</div>
						
								
								
                                </div>
								
								<div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->


															<h3 class="box-title">
																<center> <H4> <STRONG> <font color=#0F5B98> Number of cases per Governorate </font></STRONG></H4> </center>
															</h3>
														</div>
														<div class="box-body">
											<div id="holder" style="width: 100%; height:400px">
											<div id="governoratep" style="width: 100%; height:100%"></div>   
											</div>
														</div>
									</div>
                                </div>
								
								<div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->


															<h3 class="box-title">
																<center> <H4> <STRONG> <font color=#0F5B98> Number of visited families for Top 10 Districts </font></STRONG></H4> </center>
															</h3>
														</div>
														<div class="box-body">
											<div id="holder" style="width: 100%; height:400px">
											<div id="districtp" style="width: 100%; height:100%"></div>   
											</div>
														</div>
									</div>
                                </div>
								
								
                            </div><!-- /.nav-tabs-custom -->




                        </section><!-- /.Left col -->
                        <!-- right col (We are only adding the ID to make the widgets sortable)-->

                    </div><!-- /.row (main row) -->
					
<br><br>					
					<div class="row">
                        <!-- Left col -->
                        <section class="content-header">
                            <!-- Custom tabs (Charts with tabs)-->
                            <div class="nav-tabs-custom">
                                <!-- Tabs within a box -->
                                <ul class="nav nav-tabs pull-right">
                                    <li class="pull-left header"><i class="fa fa-inbox"></i> Demography</li>
                                </ul>


                                <div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->

<br>
															<h3 class="box-title">
																<H4><STRONG> <font color=#0F5B98> Vulnerability distribution by Gender of HoH </font></STRONG></H4>
															</h3>
														</div>
														<div class="box-body">
														<table>
															<tr>
																<td width=20% valign=top> 
																	<div id="PAGen" style="width: 30%; height:100%"></div>  
																</td>
																<td width=80%>
																	<div id="PAThres" style="width: 70%; height:100%"></div>   
																</td>
															</tr>
														</table>
 
														</div>
														</div>
									</div>
						
								
								
                                </div>
								
								<div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->


															<h3 class="box-title">
																<center> <H4> <STRONG> <font color=#0F5B98> Vulneranility distribution by age of HoH </font></STRONG></H4> </center>
															</h3>
														</div>
														<div class="box-body">
														<table>
															<tr>
																<td width=20% valign=top> 
																	<div id="PAGroup" style="width: 20%; height:100%"></div>  
																</td>
																<td width=80%>
																	<div id="PAThresGroup" style="width: 80%; height:100%"></div>   
																</td>
															</tr>
														</table>
																
														
 
															
														</div>
									</div>
                                </div>
								
								
								<div class="tab-content no-padding">
									<div class="col-lg-4 col-xs-6">
														<div class="box-header">
															<!-- tools box -->
															<div class="pull-right box-tools">
																	   </div><!-- /. tools -->


															<h3 class="box-title">
																<center> <H4> <STRONG> <font color=#0F5B98> Size of visited families per Governorate </font></STRONG></H4> </center>
															</h3>
														</div>
														<div class="box-body">
											<div id="holder" style="width: 100%; height:100%">
											<div id="sizep" style="width: 100%; height:100%"></div>   
											</div>
														</div>
									</div>
                                </div>
								
                            </div><!-- /.nav-tabs-custom -->
<BR><BR>
                    <div class="row">
                        <!-- Left col -->
                        <section class="content-header">
                            <!-- Custom tabs (Charts with tabs)-->
                            <div class="nav-tabs-custom">
                                <!-- Tabs within a box -->
                                <ul class="nav nav-tabs pull-right">
                                    <li class="active"><a href="#eijRange" data-toggle="tab" onclick="$('#hvrange').hide();$('#eijRange').show();">Entry in Jordan</a></li>
                                    <li><a href="#hvrange" data-toggle="tab" onclick="$('#eijRange').hide();$('#hvrange').show();">Home Visit Date</a></li>
                                    <li class="pull-left header"><i class="fa fa-inbox"></i> Time</li>
                                </ul>
                                <div class="tab-content no-padding">
                                    <!-- Morris chart - Sales -->
                                    <div class="chart tab-pane" id="hvrange" style="position: relative; height: 250px;">
                                    <div id="month" style="position: relative; height: 250px;"></div>
                                    <div id="monthrange" style="position: relative; height: 100px;"></div>
                                    </div>
                                    <div class="chart tab-pane" id="eijRange" style="position: relative; height: 250px;">
                                    <div id="eijmonth" style="position: relative; height: 250px;"></div>
                                    <div id="eijmonthrange" style="position: relative; height: 100px;"></div>
                                    </div>
                                </div>
                            </div><!-- /.nav-tabs-custom -->




                        </section><!-- /.Left col -->
                        <!-- right col (We are only adding the ID to make the widgets sortable)-->

                    </div><!-- /.row (main row) -->





                        </section><!-- /.Left col -->
                        <!-- right col (We are only adding the ID to make the widgets sortable)-->

                    </div><!-- /.row (main row) -->
					
                </section><!-- /.content -->


    <div width="100%" style="background:#006CA9; height:45px" align=Left><SPAN  class="demoTableRow"><font color="#FFFFFF">  
	&nbsp; &nbsp; Source Data: UNHCR Home Visit, UNHCR proGres <br>
	&nbsp; &nbsp; Date Range: June 2014 - Oct 2014
	</font> </SPAN> &nbsp;&nbsp;&nbsp;</div>
	<div width="100%" style="background:#FFFFFF;height:75px">
                            <ol class="breadcrumb" style="background:#FFFFFF">
                              <strong> <font color=#000000> Members of VAF Steering Committee: </font></strong> <br >
                                        <i>UN Agencies</i>: &nbsp;     <img border="0" height="33" src="images/partner/unhcr1.jpg" />
                                            <img border="0" height="33" src="images/partner/unicef.jpg" />
                                            <img border="0" height="33" src="images/partner/wfp.jpg" />
                                            <img border="0" height="33" src="images/partner/unwomen.jpg" />
                                            <img border="0" height="33" src="images/partner/who.jpg" />	
										&nbsp;&nbsp;&nbsp;&nbsp;
                                        <i>NGOs</i>: &nbsp;    <img border="0" height="33" src="images/partner/acted.jpg" />
                                            <img border="0" height="33" src="images/partner/care.jpg" />
                                            <img border="0" height="33" src="images/partner/drc.jpg" />
                                            <img border="0" height="33" src="images/partner/hi.jpg" />
                                            <img border="0" height="33" src="images/partner/pu-ami.jpg" /> 
										&nbsp;&nbsp;&nbsp;&nbsp;
                                        <i>Donors</i>: &nbsp;    <img border="0" height="33" src="images/partner/hacp.jpg" />
                                            <img border="0" height="33" src="images/partner/usa.jpg" />
                              </ol>
    </div>
        <!-- add new calendar event modal -->
    <div width="100%" style="background:#006CA9; height:25px" align=right><SPAN  class="demoTableRow"><font color="#FFFFFF">  Produced by Information Management Unit, UNHCR, Jordan. For more information please contact <a href="http://data.unhcr.org/jordan/team.html" target="_blank" >our team</a> </font> </SPAN> &nbsp;&nbsp;&nbsp;</div>
	    </aside><!-- /.right-side -->
        </div><!-- ./wrapper -->
		<script type="text/javascript" src="inc/d3.js"></script>
		<script type="text/javascript" src="inc/crossfilter.js"></script>
		<script type="text/javascript" src="inc/dc-master.js"></script>
		<script type="text/javascript" src="inc/leaflet.js"></script>



		<!--Optional-->
		<script type="text/javascript" src="inc/leaflet.markercluster.js"></script>
		<script type="text/javascript" src="inc/leaflet.markercluster1.js"></script>
		<script type="text/javascript" src="inc/dc.leaflet.js"></script>
		<script type="text/javascript" src="js/d3.tip.min.js"></script>

    <script>
        $('#dashboard').hide();
        $('#eijRange').show();
		
		function CMapShow(){
		    $('#Cmap').show();
            $('#Hmap').hide();

        }
		
		function HMapShow(){
            $('#Hmap').show();
            $('#Cmap').hide();
        }
			$('#About').hide();
			$('#AboutHide').hide();
			$('#AboutShow').show();
			
        var dataset;
        var threshold_chart = dc.barChart("#thresholds");
         var size_chart = dc.rowChart("#sizep");
        var gov_chart = dc.rowChart("#governoratep");
        var district_chart = dc.rowChart("#districtp");
        var month_chart = dc.lineChart("#month");
        var monthrange_chart = dc.barChart("#monthrange");
        var eijmonth_chart = dc.lineChart("#eijmonth");
        var eijmonthrange_chart = dc.barChart("#eijmonthrange");
		var ThresholdPie_chart = dc.pieChart("#PAThres");
		var ThresholdPieGroup_chart = dc.pieChart("#PAThresGroup");
		var PAGender_Chart = dc.rowChart("#PAGen");
		var AgeGroup_Chart = dc.rowChart("#PAGroup");


        d3.csv("data/vafdataNew.csv", function(error, dataset) {
        var dateFormat = d3.time.format("%d/%m/%Y");
        var numberFormat = d3.format(",f");

        dataset.forEach(function (d) {
            d.dd = dateFormat.parse(d.HVDate);
            d.month = d3.time.month(d.dd); // pre-calculate month for better performance
            d.dd1 = dateFormat.parse(d.EiJ);
            d.month1 = d3.time.month(d.dd1); // pre-calculate month for better performance
            d.close = +d.close; // coerce to number
            d.open = +d.open;
        });

            var cf = crossfilter(dataset);

            // Implement bookmarking chart filters status --> Thanks to https://github.com/franckalbinet
            // Serializing filters values in URL
            function getFiltersValues() {
                var filters = [
                    { name: 'thresholds', value: threshold_chart.filters()},
                    { name: 'size', value: size_chart.filters()},
                    { name: 'gov', value: gov_chart.filters()},
                    { name: 'dis', value: district_chart.filters()}
                    ];

                var recursiveEncoded = $.param( filters );
                location.hash = recursiveEncoded;
            }
            // Init chart filters
            function initFilters() {
                // Get hash values
                var parseHash = /^#asc=([A-Za-z0-9,_\-\/\s]*)&moi=([A-Za-z0-9,_\-\/\s]*)&thresholds=([A-Za-z0-9,_\-\/\s]*)$/;
                var parsed = parseHash.exec(decodeURIComponent(location.hash));
                function filter(chart, rank) {  // for instance chart = sector_chart and rank in URL hash = 1
                    // sector chart
                    if (parsed[rank] == "") {
                        chart.filter(null);
                    }
                    else {
                        var filterValues = parsed[rank].split(",");
                        for (var i = 0; i < filterValues.length; i++ ) {
                            chart.filter(filterValues[i]);
                        }
                    }
                }
                if (parsed) {
                    filter(threshold_chart, 4);
                    filter(gov_chart, 5);
                    filter(district_chart, 6);
                    filter(size_chart, 8);
                }
            }

            // tooltips for row chart
            var rowTip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " Families"; });
            var pieTip = d3.tip().attr('class', 'd3-tip').offset([-10, -10]).html(function (d) { return "<span style='color: #f0027f'>" +  d.data.key + "</span> : "  + numberFormat(d.value) + " Families"; });
            var barTip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function (d) { return "<span style='color: #f0027f'>" + d.data.key + "</span> : " + numberFormat(d.y) + " Families";});


            var all = cf.groupAll();
            
            var all = cf.groupAll();
                dc.dataCount("#count-info")
                    .dimension(cf)
                    .group(all);
            
            var byFamily = cf.dimension(function(d) { return d.Total; });
            var byFamilyGroup = byFamily.groupAll().reduceSum(function (d) { return d.size; });
            
               dc.numberDisplay("#totalind")
                    .formatNumber(d3.format(",f"))
                    .valueAccessor(function(d){return +d})
                    .group(byFamilyGroup);
					
 			var colorScale = d3.scale.ordinal().range(["#d7301f", "#fc8d59", "#fdcc8a", "#8DC63F"]);           
            cf.thresholds =  cf.dimension(function(d) { return d.Thresholds; });
            var thresholds = cf.thresholds.group();
            var thresholdsByTotal = cf.thresholds.group().reduceSum(function (d) { return d.Total; });
            
                threshold_chart.width(1150).height(115)
					.x(d3.scale.ordinal())
					.xUnits(dc.units.ordinal)
					.brushOn(false)
					.ordinalColors(["#6799CC"])
					.xAxisLabel("")
					.yAxisLabel("No. of cases")
					.dimension(cf.thresholds)
					.barPadding(0.1)
					.outerPadding(0.05)
					.group(thresholdsByTotal)
					.yAxis().ticks(0);
				threshold_chart.renderlet(function(chart){
					   chart.selectAll("g.rect.stack").attr("fill", function(d){
							if(d.key == "1-Extremely")   
						 return "#d7301f";
					else if(d.key == "2-Highly")
						 return "#fc8d59";
					 else if(d.key == "3-Moderately")
						 return "#fdcc8a"; 
					 else if(d.key == "4-Low")
						 return "#8DC63F"; 
						});})


				
			cf.paGen =  cf.dimension(function(d) { return d.PAGender; });
            var paGen = cf.paGen.group();
            var paGenByTotal = cf.paGen.group().reduceSum(function (d) { return d.Total; });
            
                 PAGender_Chart.width(50).height(50)
                .dimension(cf.paGen)
                .group(paGenByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(20);
                })
                .colors(['#6799CC'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
				.margins({top: 0, right: 0, bottom: -1, left: 0})
                .xAxis().ticks(0).tickFormat(d3.format("s"));
      
			cf.paAgeGroup =  cf.dimension(function(d) { return d.AgeGroup; });
            var paAgeGroup = cf.paAgeGroup.group();
            var paAgeGroupByTotal = cf.paAgeGroup.group().reduceSum(function (d) { return d.Total; });
            
                 AgeGroup_Chart.width(50).height(150)
                .dimension(cf.paAgeGroup)
                .group(paAgeGroupByTotal)
                .elasticX(true)
                .on("filtered", getFiltersValues)
                .data(function(group) {
                    return group.top(20);
                })
                .colors(['#6799CC'])
                .colorDomain([0,0])
                .colorAccessor(function(d, i){return 1;})
				.margins({top: 0, right: 0, bottom: -1, left: 0})
                .xAxis().ticks(0).tickFormat(d3.format("s"));


            cf.sizec = cf.dimension(function (d) {return d.size;});
            var sizec = cf.sizec.group();
            var sizecByTotal = cf.sizec.group().reduceSum(function (d) { return d.Total;} );

                size_chart.width(350).height(250)
                    .dimension(cf.sizec)
                    .group(sizecByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) { return group.top(10);})
                    .colors(['#6799CC'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));

            cf.gov = cf.dimension(function (d) {return d.Governorate;});
            var gov = cf.gov.group();
            var govByTotal = cf.gov.group().reduceSum(function (d) { return d.Total;} );

                gov_chart.width(350).height(400)
                    .dimension(cf.gov)
                    .group(govByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(20);
                    })
                    .colors(['#6799CC'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));

            cf.district = cf.dimension(function (d) {return d.District;});
            var district = cf.district.group();
            var districtByTotal = cf.district.group().reduceSum(function (d) { return d.Total;} );
            
                district_chart.width(350).height(400)
                    .dimension(cf.district)
                    .group(districtByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(10);
                    })
                    .colors(['#6799CC'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));
 /*   */

            cf.eijMonth = cf.dimension(function (d) {return d.month1;});
            var eijMonth = cf.eijMonth.group();
            var eijmonthByTotal = cf.eijMonth.group().reduceSum(function (d) { return d.Total;} );
            
                eijmonth_chart.width(1900).height(250)
                    .dimension(cf.eijMonth)
                    .group(eijmonthByTotal, "Entry in Jordan")
                    //.renderArea(true)
                    .transitionDuration(1000)
                    .margins({top: 30, right: 50, bottom: 25, left: 40})
                    .mouseZoomable(true)
                    // Specify a range chart to link the brush extent of the range with the zoom focue of the current chart.
                    .rangeChart(eijmonthrange_chart)
                    .x(d3.time.scale().domain([new Date(2011, 0, 1), new Date(2015, 5, 31)]))
                    //.round(d3.time.month.round)
                    .xUnits(d3.time.months)
                    //.elasticY(true)
                    .renderHorizontalGridLines(true)
                    .legend(dc.legend().x(1400).y(20).itemHeight(13).gap(5))
                    .brushOn(false)
                    // Add the base layer of the stack with group. The second parameter specifies a series name for use in the legend
                    // The `.valueAccessor` will be used for the base layer
                    .valueAccessor(function (d) {
                        return d.value;
                    });
//                    .colors(['#006CA9']);
                    // stack additional layers with `.stack`. The first paramenter is a new group.
                    // The second parameter is the series name. The third is a value accessor.
                    //.stack(monthlyMoveGroup, "Monthly Index Move", function (d) {
                    //  return d.value;
                    //})
                    // title can be called by any stack layer.
                    //.title(function (d) {
                    //  var value = d.value.avg ? d.value.avg : d.value;
                    //  if (isNaN(value)) value = 0;
                    //  return dateFormat(d.key) + "\n" + numberFormat(value);
                    //});
    
                eijmonthrange_chart.width(1900).height(40)
                    .margins({top: 0, right: 50, bottom: 20, left: 40})
                    .dimension(cf.eijMonth)
                    .group(eijmonthByTotal)
                    //.centerBar(true)
                    .colors(['#6799CC'])
                    .gap(1)
                    .x(d3.time.scale().domain([new Date(2011, 0, 1), new Date(2015, 5, 31)]))
                    //.round(d3.time.month.round)
                    //.alwaysUseRounding(true)
                    .xUnits(d3.time.months);
                    eijmonthrange_chart.yAxis().ticks(0);
                
            
            cf.month = cf.dimension(function (d) {return d.month;});
            var month = cf.month.group();
            var monthByTotal = cf.month.group().reduceSum(function (d) { return d.Total;} );

                month_chart.width(1900).height(250)
                    .dimension(cf.month)
                    .group(monthByTotal, "Home Visit")
                    //.renderArea(true)
                    .transitionDuration(1000)
                    .margins({top: 30, right: 50, bottom: 25, left: 40})
                    .mouseZoomable(true)
                    // Specify a range chart to link the brush extent of the range with the zoom focue of the current chart.
                    .rangeChart(monthrange_chart)
                    .x(d3.time.scale().domain([new Date(2014, 4, 1), new Date(2015, 5, 31)]))
                    //.round(d3.time.month.round)
                    .xUnits(d3.time.months)
                    //.elasticY(true)
                    .renderHorizontalGridLines(true)
                    .legend(dc.legend().x(1400).y(20).itemHeight(13).gap(5))
                    .brushOn(false)
                    // Add the base layer of the stack with group. The second parameter specifies a series name for use in the legend
                    // The `.valueAccessor` will be used for the base layer
                    .valueAccessor(function (d) {
                        return d.value;
                    })
                    //.colors(['#006CA9']);
                    // stack additional layers with `.stack`. The first paramenter is a new group.
                    // The second parameter is the series name. The third is a value accessor.
                    //.stack(monthlyMoveGroup, "Monthly Index Move", function (d) {
                    //  return d.value;
                    //})
                    // title can be called by any stack layer.
                    //.title(function (d) {
                    //  var value = d.value.avg ? d.value.avg : d.value;
                    //  if (isNaN(value)) value = 0;
                    //  return dateFormat(d.key) + "\n" + numberFormat(value);
                    //});

				var facilitiesC = cf.dimension(function(d) { return d.geo; });
				var facilitiesGroupC = facilitiesC.group().reduceCount();
				
				dc.leafletMarkerChartCluster("#Hmap")
				  .dimension(facilitiesC)
				  .group(facilitiesGroupC)
				  .center([31.3482,36.819])
				  .zoom(7)
				  .renderPopup(false)
				  .cluster(true)
				  .filterByArea(true);  
				  
                monthrange_chart.width(1900).height(40)
                    .dimension(cf.month)
                    .group(monthByTotal)
                    .margins({top: 0, right: 50, bottom: 20, left: 40})
                    //.centerBar(true)
                    .colors(['#6799CC'])
                    .gap(1)
                    .x(d3.time.scale().domain([new Date(2014, 4, 1), new Date(2015, 5, 31)]))
                    //.round(d3.time.month.round)
                    //.alwaysUseRounding(true)
                    .xUnits(d3.time.months);
                    monthrange_chart.yAxis().ticks(0);
					

				var facilities = cf.dimension(function(d) { return d.geo; });
				var facilitiesGroup = facilities.group().reduceCount();
				dc.leafletMarkerChart("#Cmap")
				  .dimension(facilities)
				  .group(facilitiesGroup)
				  .center([31.3482,36.819])
				  .zoom(7)
				  .renderPopup(false)
				  .cluster(true)
				  .filterByArea(true);  
				
				
            cf.thresholds1 =  cf.dimension(function(d) { return d.Thresholds; });
            var thresholds1 = cf.thresholds1.group();
            var thresholdsByTotal1 = cf.thresholds1.group().reduceSum(function (d) { return d.Total; });
//			var colorScale = d3.scale.ordinal().domain(["1-Extremely", "2-Highly", "3-Moderately", "4-Low"]).range(["#d7301f", "#fc8d59", "#fdcc8a", "fef0d9"]);

				
				ThresholdPie_chart.width(260).height(260)
                .dimension(cf.thresholds1)
                .group(thresholdsByTotal1)
                .innerRadius(4)
                .renderLabel(true)
                .on("filtered", getFiltersValues);
				ThresholdPie_chart.colors(colorScale);

            cf.thresholds2 =  cf.dimension(function(d) { return d.Thresholds; });
            var thresholds2 = cf.thresholds2.group();
            var thresholdsByTotal2 = cf.thresholds2.group().reduceSum(function (d) { return d.Total; });
			
				ThresholdPieGroup_chart.width(260).height(260)
                .dimension(cf.thresholds2)
                .group(thresholdsByTotal2)
                .innerRadius(4)
                .renderLabel(true)
                .on("filtered", getFiltersValues);
				ThresholdPieGroup_chart.colors(colorScale);
				
                dc.dataCount("#count-info")
                    .dimension(cf)
                    .group(all);



                            $('#loading').hide();
                            $('#dashboard').show();
                            dc.renderAll();

                            /* Customised infobox */
                            d3.selectAll("g.row").call(rowTip);
                            d3.selectAll("g.row").on('mouseover', rowTip.show)
                                .on('mouseout', rowTip.hide);

                            d3.selectAll(".pie-slice").call(pieTip);
                            d3.selectAll(".pie-slice").on('mouseover', pieTip.show)
                                .on('mouseout', pieTip.hide);
							
							d3.selectAll("g.bar").call(barTip);
                            d3.selectAll("g.bar").on('mouseover', barTip.show)
                                .on('mouseout', barTip.hide);

        });
		
    </script>

    <script src="js/bootstrap.js"></script>

    </body>
</html>
