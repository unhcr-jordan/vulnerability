<!DOCTYPE html>
<html>
<head>
        <meta charset="UTF-8">
        <title>Vulnerability Assessment Framework - Jordan </title>
        <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

         <!-- Theme style -->
        <link href="http://www.unhcr.org/favicon.ico" rel="icon" type="image/x-icon">
        <link rel="stylesheet" type="text/css" href="css/vafTheme.css" />

        <!-- Bootstrap -->
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/dc.css"/>
        <link rel="stylesheet" type="text/css" href="css/3w-dashboard.css"/>

        <!-- Add IntroJs styles and JS -->
        <link rel="stylesheet" type="text/css" href="css/introjs.min.css" >
        <script type="text/javascript" src="js/intro.min.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/intro.js"></script>
        
        <!-- map the data to the GeoJSON object -->
        <script src="js/data-jo.js"></script>

</head>

<body class="skin-blue">
    
    
        <div style="display: none;" class="col-sm-4 col-md-offset4" id="loading">
            <h1>Patience: We are wrapping up the data... </h1><small>This webpage does not work on IE8 or older... Upgrade your browser if needed</small>
        </div>
    
        <!-- header logo: style can be found in header.less -->
        <header class="header">
        </header>
        
        
        <div id="dashboard">

            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1><strong> Vulnerability Assessment Framework (VAF) - Jordan</strong></h1>
                    <div class="row">
                        <div class="col-lg-4 col-xs-4">
                           <font color=#FFFFFF> <strong>Second draft - work in progress - <a href="indexa.html">first draft for record here</a></strong><br>
                               This data visualisation displays vulnerability profiles, calculated from a <i>"welfare statistical model"</i> and based on information collected through interviews
                            with syrian refugee households in Jordan in the second half of 2014. <br >
                           For a full explanation of the VAF model, please visit <a href="http://data.unhcr.org/syrianrefugees/working_group.php?Page=Country&LocationId=107&Id=69"> our dedicated portal page</a>.<br >
                           The methodology for interviews is not randomized, which could lead to some bias. <a href="http://data.unhcr.org/syrianrefugees/working_group.php?Page=Country&LocationId=107&Id=69">An analysis of
                            the bias vs sample</a> confirmed that the sample is defensible for analysis purposes at a national level.
                            At the governorate and district level, there may be further limitations in sample size.<br > </font>
                        </div>

                        <div class="col-lg-4 col-xs-4">

                            <div id="count-info" data-step="1" data-intro="This displays the number of families you filtered. Use the reset button to delete all your filters" data-position="right">
                                <p></p><strong><span class="filter-count"></span></strong> families selected out of <strong><span class="total-count"></span></strong>
                                 records in the sample, corresponding to <strong><span id="totalind" class="number-display"></span> individuals</strong>.
                                </p>
                            </div>
                            
                            <a class="reset btn btn-primary btn-sm" id="reset" href="#">Reset All Filters</a>  &nbsp;&nbsp;&nbsp;
                            <a class="btn btn btn-success" href="javascript:void(0);" onclick="javascript:introJs().start();">How to explore this page?</a>
                        </div>
                        <div class="col-lg-4 col-xs-4">
                            <ol class="breadcrumb">
                              <strong> <font color=#000000> Members of VAF Steering Committee: </font></strong> <br >
                                        <i>NGOs</i>:     <img border="0" height="33" src="images/partner/acted.jpg" />
                                            <img border="0" height="33" src="images/partner/care.jpg" />
                                            <img border="0" height="33" src="images/partner/drc.jpg" />
                                            <img border="0" height="33" src="images/partner/hi.jpg" />
                                            <img border="0" height="33" src="images/partner/pu-ami.jpg" /> <br >
                                        <i>UN Agencies</i>:      <img border="0" height="33" src="images/partner/unhcr1.jpg" />
                                            <img border="0" height="33" src="images/partner/unicef.jpg" />
                                            <img border="0" height="33" src="images/partner/wfp.jpg" />
                                            <img border="0" height="33" src="images/partner/unwomen.jpg" />
                                            <img border="0" height="33" src="images/partner/who.jpg" />  <br >
                                        <i>Donors</i>:     <img border="0" height="33" src="images/partner/hacp.jpg" />
                                            <img border="0" height="33" src="images/partner/usa.jpg" />
                              </ol>
                        </div>
                    </div>
                </section>

                <!-- Main content -->
                <section class="content">

                    <!-- Small boxes (Stat box) -->
                    <div class="row">
                        <div class="col-lg-3 col-xs-6" data-step="2" data-intro="This displays the vulnerability level" data-position="right">
                            <div class="small-box bg-green">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Vulnerability Threeshold </font><br > <small> According to Welfare model</small>
                                </span>
                                <div class="inner">
                                    <div id="thresholds"> </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-xs-6" data-step="3" data-intro="This displays the welfare level" data-position="right">
                            <div class="small-box bg-green">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Welfare histogram </font><br > <small> According to Welfare model</small>
                                </span>
                                <div class="inner">
                                    <div id="welfarep"> </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-xs-6" data-step="3" data-intro="This displays the welfare level" data-position="right">
                            <div class="small-box bg-green">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Crowding histogram </font><br > <small> </small>
                                </span>
                                <div class="inner">
                                    <div id="crowdingp"> </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-xs-6" data-step="3" data-intro="This displays the welfare level" data-position="right">
                            <div class="small-box bg-green">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Income histogram </font><br > <small> According to Welfare model</small>
                                </span>
                                <div class="inner">
                                    <div id="incomep"> </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-xs-6" data-step="3" data-intro="This displays the welfare level" data-position="right">
                            <div class="small-box bg-green">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Debt to expenditure ratio histogram </font><br > <small> According to Welfare model</small>
                                </span>
                                <div class="inner">
                                    <div id="debtexpp"> </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">


                        <div class="col-lg-2 col-xs-2" data-step="3" data-intro="This displays the bulnerability level" data-position="right">
                           <!-- <div class="small-box bg-yellow"> -->
                            <div class="small-box  bg-red">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF> Valid Legal Documentation  </font><br > <small> UNHCR Asylum Seeker Certificate / MOI Card</small>
                                </span>
                                <div class="inner">
                                    <div id="asc"> </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-2 col-xs-2" data-step="4" data-intro="This displays the bulnerability level" data-position="right">
                           <!-- <div class="small-box bg-red"> -->
                            <div class="small-box  bg-red">
                                <span class="small-box-footer">
                                    <font color=#FFFFFF>  Governorate Registered with MOI </font> <br > <small> Home visit took place in the governorate where MOI card was issued</small>
                                </span>
                                <div class="inner">
                                    <div id="moi"> </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        <!-- Left col -->
                        <section class="col-lg-8 connectedSortable">

                            <div class="row">
                                <div class="col-lg-2 col-xs-2">
                                    <div class="small-box bg-aqua">
                                        <span class="small-box-footer">
                                         <font color=#FFFFFF> Age & Sex Breakdown </font>
                                        </span>
                                        <div class="inner">
                                            <table cellpadding="0" cellspacing="1" width="100%" class='demoTable' style="margin-top: 7px;">
                                                <tr>
                                                    <td  class="demoTableRowCenter"  style="text-align: left; width: auto;" colspan="2" style="border-bottom: 1px dotted #dcdcdc;">
                                                        <b>Male</b>
                                                        (49.1%)
                                                    </td>

                                                    <td  class="demoTableRowCenter"  align="center" style="border-bottom: 1px dotted #dcdcdc;">
                                                        <b>Age</b>
                                                    </td>
                                                    <td  class="demoTableRowCenter"  style="text-align: right; width: auto;" colspan="2" style="border-bottom: 1px dotted #dcdcdc;">
                                                        (50.9%)
                                                        <b>Female</b>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td align="" width="50px"></td>
                                                    <td style="text-align: right;" width="115px" height="8px"></td>
                                                    <td align="" width="70px"></td>
                                                    <td align="left" width="115px"></td>
                                                    <td align="" width="50px"></td>
                                                </tr>

                                                <tr class="demoTableFullRow">
                                                    <td class="demoTableRow"  style="text-align: center; width: auto;" width="50px">9.3%</td>
                                                    <td class="demoTableRow" style="text-align: right; width: auto;" width="115px"><img src="images/barchart.jpg" width="39.715554943352%" height="12" align="right"/></td>

                                                    <td class="demoTableRowCenter" style="text-align: center; width: auto;" width="70px"><b>0 - 4</b></td>

                                                    <td class="demoTableRow" style="text-align: left; width: auto;" width="115px" ><img src="images/barchartf.jpg" align="left" width="37.509556114191%" height="12"/></td>
                                                    <td class="demoTableRow" style="text-align: center; width: auto;" width="50px">8.8%</td>
                                                </tr>
                                                <tr class="demoTableFullRow">
                                                    <td class="demoTableRow"  style="text-align: center; width: auto;" width="50px">10.8%</td>
                                                    <td class="demoTableRow" style="text-align: right; width: auto;" width="115px"><img src="images/barchart.jpg" width="45.960949068494%" height="12" align="right"/></td>

                                                    <td class="demoTableRowCenter" style="text-align: center; width: auto;" width="70px"><b>5 - 11</b></td>

                                                    <td class="demoTableRow" style="text-align: left; width: auto;" width="115px" ><img src="images/barchartf.jpg" align="left" width="43.743930576122%" height="12"/></td>
                                                    <td class="demoTableRow" style="text-align: center; width: auto;" width="50px">10.2%</td>
                                                </tr>
                                                <tr class="demoTableFullRow">
                                                    <td class="demoTableRow"  style="text-align: center; width: auto;" width="50px">6.9%</td>
                                                    <td class="demoTableRow" style="text-align: right; width: auto;" width="115px"><img src="images/barchart.jpg" width="29.612589965219%" height="12" align="right"/></td>

                                                    <td class="demoTableRowCenter" style="text-align: center; width: auto;" width="70px"><b>12 - 17</b></td>

                                                    <td class="demoTableRow" style="text-align: left; width: auto;" width="115px" ><img src="images/barchartf.jpg" align="left" width="27.668308137333%" height="12"/></td>
                                                    <td class="demoTableRow" style="text-align: center; width: auto;" width="50px">6.5%</td>
                                                </tr>
                                                <tr class="demoTableFullRow">
                                                    <td class="demoTableRow"  style="text-align: center; width: auto;" width="50px">20.7%</td>
                                                    <td class="demoTableRow" style="text-align: right; width: auto;" width="115px"><img src="images/barchart.jpg" width="88.514756017769%" height="12" align="right"/></td>

                                                    <td class="demoTableRowCenter" style="text-align: center; width: auto;" width="70px"><b>18 - 59</b></td>

                                                    <td class="demoTableRow" style="text-align: left; width: auto;" width="115px" ><img src="images/barchartf.jpg" align="left" width="100%" height="12"/></td>
                                                    <td class="demoTableRow" style="text-align: center; width: auto;" width="50px">23.4%</td>
                                                </tr>
                                                <tr class="demoTableFullRow">
                                                    <td class="demoTableRow"  style="text-align: center; width: auto;" width="50px">1.4%</td>
                                                    <td class="demoTableRow" style="text-align: right; width: auto;" width="115px"><img src="images/barchart.jpg" width="6.1606804642033%" height="12" align="right"/></td>

                                                    <td class="demoTableRowCenter" style="text-align: center; width: auto;" width="70px"><b>60 +</b></td>

                                                    <td class="demoTableRow" style="text-align: left; width: auto;" width="115px" ><img src="images/barchartf.jpg" align="left" width="8.428664898929%" height="12"/></td>
                                                    <td class="demoTableRow" style="text-align: center; width: auto;" width="50px">2%</td>
                                                </tr>
                                                <tr>
                                                    <td align="" width="50px"></td>
                                                    <td style="text-align: right;" width="115px" height="10px"></td>
                                                    <td align="" width="70px"></td>
                                                    <td align="left" width="115px"></td>
                                                    <td align="" width="50px"></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-lg-3 col-xs-3" data-step="5" data-intro="This displays the bulnerability level" data-position="right">
                                    <div class="small-box bg-aqua">
                                        <span class="small-box-footer">
                                            <font color=#FFFFFF> Size of visited families per Governorate</font>
                                        </span>
                                        <div class="inner">
                                            <div id="sizep"> </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-xs-3" data-step="5" data-intro="This displays the vulnerability level" data-position="right">
                                    <div class="small-box bg-aqua">
                                        <span class="small-box-footer">
                                            <font color=#FFFFFF> Number of visited families per Governorate</font>
                                        </span>
                                        <div class="inner">
                                            <div id="governoratep"> </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-xs-3" data-step="6" data-intro="This displays the bulnerability level" data-position="right">
                                    <div class="small-box bg-aqua">
                                        <span class="small-box-footer">
                                            <font color=#FFFFFF> Number of visited families for Top 10 Districts</font>
                                        </span>
                                        <div class="inner">
                                            <div id="districtp"> </div>
                                        </div>
                                    </div>
                                </div>
<!--
                                <div class="col-lg-3 col-xs-6">
                                    <div class="nav-tabs-custom">
                                            <ul class="nav nav-tabs pull-right">
                                                <li class="pull-left header"><i class="fa fa-inbox"></i>Threshold of Vulnerability - per Governorate </li>
                                            </ul>
                                            <div class="tab-content no-padding">
                                                <div id="stackedbar-chart"> </div>
                                            </div>
                                    </div>
                                </div>
                                -->
                            </div>
                            <!-- Custom tabs (Charts with tabs)-->
                            <div class="nav-tabs-custom">
                                <!-- Tabs within a box for date trend -->
                                <ul class="nav nav-tabs pull-right">
                                    <li class="active"><a href="#eijRange" data-toggle="tab" onclick="$('#hvrange').hide();$('#eijRange').show();">Entry in Jordan</a></li>
                                    <li><a href="#hvrange" data-toggle="tab" onclick="$('#eijRange').hide();$('#hvrange').show();">Home Visit Date</a></li>
                                    <li class="pull-left header"><i class="fa fa-inbox"></i> Trend by Date</li>
                                </ul>
                                <div class="tab-content no-padding">
                                    <!-- Morris chart - Sales -->
                                    <div class="chart tab-pane" id="hvrange" style="position: relative; height: 400px;">
                                    <div id="month" style="position: relative; height: 400px;"></div>
                                    <div id="monthrange" style="position: relative; height: 100px;"></div>
                                    </div>
                                    <div class="chart tab-pane" id="eijRange" style="position: relative; height: 400px;">
                                    <div id="eijmonth" style="position: relative; height: 400px;"></div>
                                    <div id="eijmonthrange" style="position: relative; height: 100px;"></div>
                                    </div>
                                </div>
                            </div><!-- /.nav-tabs-custom -->
                        </section><!-- /.Left col -->


                        <!-- right col (We are only adding the ID to make the widgets sortable)-->
                        <section class="col-lg-4 connectedSortable">
                            <!-- Map box -->
                            <div class="box box-solid bg-light-blue-gradient" data-step="7" data-intro="TClick on the map to filter per geographic area" data-position="left">
                                <div class="box-header">
                                    <!-- tools box icon --><div class="pull-right box-tools"></div><!-- /. tools -->
                                    <h3 class="box-title">
                                        <h4><strong> <font color=#666666> Geographic filter</font></strong></h4>
                                    </h3>
                                </div>
                                <div class="box-body">
                                    <div style="height: 750px;">
                                             <div id="map"></div>
                                    </div>
                                </div><!-- /.box-body-->
                                <div class="box-footer no-border">
                                    <div class="row">
                                        <div class="col-xs-4 text-center" style="border-right: 1px solid #f4f4f4"></div><!-- ./col -->
                                    </div><!-- /.row -->
                                </div>
                            </div>
                            <!-- /. Map - box -->

                        </section><!-- right col -->
                    </div><!-- /.row (main row) -->
                </section><!-- /.content -->

            </aside><!-- /.right-side -->
        </div><!-- ./ dashboard wrapper -->


    <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/d3.tip.min.js"></script>

<!--maps-->
    <script type="text/javascript" src="js/leaflet.js"></script>
    <script type="text/javascript" src="js/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="js/dc.leaflet.js"></script>

    <script>

        $('#dashboard').hide();
        $('#eijRange').show();



        var dateFormat = d3.time.format("%d/%m/%Y");
        var numberFormat = d3.format(",f");


d3.tsv("data/vafdata2.tsv", function(data) {
       drawMarkerArea(data);
});


function drawMarkerArea(data) {

        var cf = crossfilter(data);


        data.forEach(function (d) {
            d.dd = dateFormat.parse(d.HVDate);
            d.month = d3.time.month(d.dd); // pre-calculate month for better performance
            d.dd1 = dateFormat.parse(d.EiJ);
            d.month1 = d3.time.month(d.dd1); // pre-calculate month for better performance
            d.close = +d.close; // coerce to number
            d.open = +d.open;
        });
        
        var groupname = "marker-select";
        var threshold_chart = dc.rowChart("#thresholds",groupname);
        var welfare_chart = dc.barChart("#welfarep",groupname);
        var asc_chart = dc.pieChart("#asc",groupname);
        var crowding_chart = dc.barChart("#crowdingp",groupname);
        var income_chart = dc.barChart("#incomep",groupname);
        var debtexp_chart = dc.barChart("#debtexpp",groupname);
        var moi_chart = dc.pieChart("#moi",groupname);
        var size_chart = dc.rowChart("#sizep",groupname);
        var gov_chart = dc.rowChart("#governoratep",groupname);
        var district_chart = dc.rowChart("#districtp",groupname);
        var month_chart = dc.lineChart("#month",groupname);
        var monthrange_chart = dc.barChart("#monthrange",groupname);
        var eijmonth_chart = dc.lineChart("#eijmonth",groupname);
        var eijmonthrange_chart = dc.barChart("#eijmonthrange",groupname);
        var map_chart = dc.leafletMarkerChart("#map",groupname);

            // Implement bookmarking chart filters status --> Thanks to https://github.com/franckalbinet
            // Serializing filters values in URL
            function getFiltersValues() {
                var filters = [
                    { name: 'thresholds', value: threshold_chart.filters()},
                    { name: 'welfare', value: welfare_chart.filters()},
                    { name: 'crowding', value: crowding_chart.filters()},
                    { name: 'income', value: income_chart.filters()},
                    { name: 'debtexp', value: debtexp_chart.filters()},
                    { name: 'asc', value: asc_chart.filters()},
                    { name: 'moi', value: moi_chart.filters()},
                    { name: 'map', value: map_chart.filters()},
                    { name: 'size', value: size_chart.filters()},
                    { name: 'gov', value: gov_chart.filters()},
                    { name: 'dis', value: district_chart.filters()}
                    ];

                var recursiveEncoded = $.param( filters );
                location.hash = recursiveEncoded;
            }
            // Init chart filters
            function initFilters() {
                // Get hash values
                var parseHash = /^#asc=([A-Za-z0-9,_\-\/\s]*)&moi=([A-Za-z0-9,_\-\/\s]*)&thresholds=([A-Za-z0-9,_\-\/\s]*)$/;
                var parsed = parseHash.exec(decodeURIComponent(location.hash));
                function filter(chart, rank) {  // for instance chart = sector_chart and rank in URL hash = 1
                    // sector chart
                    if (parsed[rank] == "") {
                        chart.filter(null);
                    }
                    else {
                        var filterValues = parsed[rank].split(",");
                        for (var i = 0; i < filterValues.length; i++ ) {
                            chart.filter(filterValues[i]);
                        }
                    }
                }
                if (parsed) {
                    filter(asc_chart, 1);
                    filter(moi_chart, 3);
                    filter(threshold_chart, 4);
                    filter(gov_chart, 5);
                    filter(district_chart, 6);
                    filter(welfare_chart, 7);
                    filter(size_chart, 8);
                    filter(crowding_chart, 9);
                    filter(income_chart, 10);
                    filter(debtexp_chart, 11);
                }
            }

            /* tooltips for row chart
            var rowTip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function (d) { return "<span style='color: #f0027f'>" +  d.key + "</span> : "  + numberFormat(d.value) + " Families"; });
            var pieTip = d3.tip().attr('class', 'd3-tip').offset([-10, -10]).html(function (d) { return "<span style='color: #f0027f'>" +  d.data.key + "</span> : "  + numberFormat(d.value) + " Families"; });
            var barTip = d3.tip().attr('class', 'd3-tip').offset([-10, 0]).html(function (d) { return "<span style='color: #f0027f'>" + d.data.key + "</span> : " + numberFormat(d.y) + " Families";});
            */


            var all = cf.groupAll();
                dc.dataCount("#count-info",groupname)
                    .dimension(cf)
                    .group(all);

            var byFamily = cf.dimension(function(d) { return d.Total; });
            var byFamilyGroup = byFamily.groupAll().reduceSum(function (d) { return d.size; });

               dc.numberDisplay("#totalind",groupname)
                    .formatNumber(d3.format(",f"))
                    .valueAccessor(function(d){return +d})
                    .group(byFamilyGroup);

            cf.thresholds =  cf.dimension(function(d) { return d.Thresholds; });
            var thresholds = cf.thresholds.group();
            var thresholdsByTotal = cf.thresholds.group().reduceSum(function (d) { return d.Total; });

                threshold_chart.width(200).height(200)
                    .dimension(cf.thresholds)
                    .group(thresholdsByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .colors(['#d7301f', /* Extremely Vulnerable */
                            '#fc8d59', /* Highly Vulnerable` */
                            '#fdcc8a', /* Low Vulnerable */
                            '#fef0d9' /* Moderate Vulnerable */
                            ])
                  .colorDomain([0,4])
                  .colorAccessor(function(d, i){return i%5;})
                    .margins({top: 0, right: 5, bottom: 20, left: 5})
                    .xAxis().ticks(10).tickFormat(d3.format("s"));

            cf.welfare =  cf.dimension(function(d) { return d.welfare; });
            var welfare = cf.welfare.group();
            var welfareByTotal = cf.welfare.group().reduceSum(function (d) { return d.Total; });

                welfare_chart.width(400).height(200)
                    .dimension(cf.welfare)
                    .group(welfareByTotal)
                    .margins({top: 10, right: 10, bottom: 20, left: 20})
                    .transitionDuration(500)
                    .centerBar(true)
                    .gap(1)
                   // .filter([1, 8])
                    .x(d3.scale.linear().domain([1, 120]))
                    .elasticY(true)
                    .on("filtered", getFiltersValues)
                    .xAxis().ticks(10).tickFormat();

            cf.crowding =  cf.dimension(function(d) { return d.crowding; });
            var crowding = cf.crowding.group();
            var crowdingByTotal = cf.crowding.group().reduceSum(function (d) { return d.Total; });

                crowding_chart.width(400).height(200)
                    .dimension(cf.crowding)
                    .group(crowdingByTotal)
                    .margins({top: 10, right: 10, bottom: 20, left: 20})
                    .transitionDuration(500)
                    .centerBar(true)
                    .gap(1)
                   // .filter([1, 8])
                    .x(d3.scale.linear().domain([1, 10]))
                    .elasticY(true)
                    .on("filtered", getFiltersValues)
                    .xAxis().ticks(10).tickFormat();

            cf.debtexp =  cf.dimension(function(d) { return d.debtexp; });
            var debtexp = cf.debtexp.group();
            var debtexpByTotal = cf.debtexp.group().reduceSum(function (d) { return d.Total; });

                debtexp_chart.width(400).height(200)
                    .dimension(cf.debtexp)
                    .group(debtexpByTotal)
                    .margins({top: 10, right: 10, bottom: 20, left: 20})
                    .transitionDuration(500)
                    .centerBar(true)
                    .gap(1)
                   // .filter([1, 8])
                    .x(d3.scale.linear().domain([1, 50]))
                    .elasticY(true)
                    .on("filtered", getFiltersValues)
                    .xAxis().ticks(10).tickFormat();

            cf.income =  cf.dimension(function(d) { return d.income; });
            var income = cf.income.group();
            var incomeByTotal = cf.income.group().reduceSum(function (d) { return d.Total; });

                income_chart.width(400).height(200)
                    .dimension(cf.income)
                    .group(incomeByTotal)
                    .margins({top: 10, right: 10, bottom: 20, left: 20})
                    .transitionDuration(500)
                    .centerBar(true)
                    .gap(1)
                   // .filter([1, 8])
                    .x(d3.scale.linear().domain([1, 120]))
                    .elasticY(true)
                    .on("filtered", getFiltersValues)
                    .xAxis().ticks(10).tickFormat();

            cf.moi =  cf.dimension(function(d) { return d.ASCMOI; });
            var moi = cf.moi.group();
            var moiByTotal = cf.moi.group().reduceSum(function (d) { return d.Total; });

                moi_chart.width(200).height(200)
                    .dimension(cf.moi)
                    .group(moiByTotal)
                    .renderLabel(true)
                    .renderTitle(true)
                 //   .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(20);
                    })
                  .colors(['#beaed4', /* yes */
                           '#fdc086', /* no */
                           '#7fc97f' /* unknow */
                                ])
                  .colorDomain([0,2])
                  .colorAccessor(function(d, i){return i%3;});

            cf.asc =  cf.dimension(function(d) { return d.MOIREG; });
            var asc = cf.asc.group();
            var ascByTotal = cf.asc.group().reduceSum(function (d) { return d.Total; });

                asc_chart.width(200).height(200)
                    .dimension(cf.asc)
                    .group(ascByTotal)
                    .renderLabel(true)
                   .renderTitle(true)
                 //    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(20);
                    })
                  .colors(['#8dd3c7',  /*Both Card */
                                '#ffffb3', /*Non valid UNHCR Card - Valid MoI Card */
                                '#bebada', /*Only valid UNHCR Card - MoI Card unknwon */
                                '#fb8072', /*Non valid UNHCR Card - MoI Card unknwon */
                                '#80b1d3', /*Only valid UNHCR Card */
                                '#fdb462',/*Non valid UNHCR Card - No MoI Card */
                                ])
                  .colorDomain([0,5])
                  .colorAccessor(function(d, i){return i%6;});

            cf.sizec = cf.dimension(function (d) {return d.size;});
            var sizec = cf.sizec.group();
            var sizecByTotal = cf.sizec.group().reduceSum(function (d) { return d.Total;} );

                size_chart.width(320).height(320)
                    .dimension(cf.sizec)
                    .group(sizecByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) { return group.top(20);})
                    .colors(['#FFFFFF'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));

            cf.gov = cf.dimension(function (d) {return d.Governorate;});
            var gov = cf.gov.group();
            var govByTotal = cf.gov.group().reduceSum(function (d) { return d.Total;} );

                gov_chart.width(320).height(320)
                    .dimension(cf.gov)
                    .group(govByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(20);
                    })
                    .colors(['#FFFFFF'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));

            cf.district = cf.dimension(function (d) {return d.District;});
            var district = cf.district.group();
            var districtByTotal = cf.district.group().reduceSum(function (d) { return d.Total;} );

                district_chart.width(320).height(320)
                    .dimension(cf.district)
                    .group(districtByTotal)
                    .elasticX(true)
                    .on("filtered", getFiltersValues)
                    .data(function(group) {
                        return group.top(10);
                    })
                    .colors(['#FFFFFF'])
                    .colorDomain([0,0])
                    .colorAccessor(function(d, i){return 1;})
                    .xAxis().ticks(6).tickFormat(d3.format("s"));

            cf.eijMonth = cf.dimension(function (d) {return d.month1;});
            var eijMonth = cf.eijMonth.group();
            var eijmonthByTotal = cf.eijMonth.group().reduceSum(function (d) { return d.Total;} );

                eijmonth_chart.width(920).height(370)
                    .dimension(cf.eijMonth)
                    .group(eijmonthByTotal, "Entry in Jordan")
                    //.renderArea(true)
                    .transitionDuration(1000)
                    .margins({top: 30, right: 50, bottom: 25, left: 40})
                    .mouseZoomable(true)
                    // Specify a range chart to link the brush extent of the range with the zoom focue of the current chart.
                    .rangeChart(eijmonthrange_chart)
                    .x(d3.time.scale().domain([new Date(2011, 0, 1), new Date(2014, 11, 31)]))
                    //.round(d3.time.month.round)
                    .xUnits(d3.time.months)
                    //.elasticY(true)
                    .renderHorizontalGridLines(true)
                    .legend(dc.legend().x(800).y(20).itemHeight(13).gap(5))
                    .brushOn(false)
                    // Add the base layer of the stack with group. The second parameter specifies a series name for use in the legend
                    // The `.valueAccessor` will be used for the base layer
                    .valueAccessor(function (d) {
                        return d.value;
                    })
                    .colors(['#006CA9']);

                eijmonthrange_chart.width(920).height(40)
                    .margins({top: 0, right: 50, bottom: 20, left: 40})
                    .dimension(cf.eijMonth)
                    .group(eijmonthByTotal)
                    //.centerBar(true)
                    .colors(['#006CA9'])
                    .gap(1)
                    .x(d3.time.scale().domain([new Date(2011, 0, 1), new Date(2014, 11, 31)]))
                    //.round(d3.time.month.round)
                    //.alwaysUseRounding(true)
                    .xUnits(d3.time.months);
                    eijmonthrange_chart.yAxis().ticks(0);


            cf.month = cf.dimension(function (d) {return d.month;});
            var month = cf.month.group();
            var monthByTotal = cf.month.group().reduceSum(function (d) { return d.Total;} );

                month_chart.width(920).height(370)
                    .dimension(cf.month)
                    .group(monthByTotal, "Home Visit")
                    //.renderArea(true)
                    .transitionDuration(1000)
                    .margins({top: 30, right: 50, bottom: 25, left: 40})
                    .mouseZoomable(true)
                    // Specify a range chart to link the brush extent of the range with the zoom focue of the current chart.
                    .rangeChart(monthrange_chart)
                    .x(d3.time.scale().domain([new Date(2014, 0, 1), new Date(2014, 11, 31)]))
                    //.round(d3.time.month.round)
                    .xUnits(d3.time.months)
                    //.elasticY(true)
                    .renderHorizontalGridLines(true)
                    .legend(dc.legend().x(800).y(20).itemHeight(13).gap(5))
                    .brushOn(false)
                    // Add the base layer of the stack with group. The second parameter specifies a series name for use in the legend
                    // The `.valueAccessor` will be used for the base layer
                    .valueAccessor(function (d) {
                        return d.value;
                    })
                    .colors(['#006CA9']);

                monthrange_chart.width(920).height(40)
                    .dimension(cf.month)
                    .group(monthByTotal)
                    .margins({top: 0, right: 50, bottom: 20, left: 40})
                    //.centerBar(true)
                    .colors(['#006CA9'])
                    .gap(1)
                    .x(d3.time.scale().domain([new Date(2014, 0, 1), new Date(2014, 11, 31)]))
                    //.round(d3.time.month.round)
                    //.alwaysUseRounding(true)
                    .xUnits(d3.time.months);
                    monthrange_chart.yAxis().ticks(0);

            var mappy = cf.dimension(function(d) { return d.geo; });
            var mappyGroup = mappy.group().reduceCount();

                 map_chart.width(400).height(390)
                    .dimension(mappy)
                    .group(mappyGroup)
                    .center([31.048, 36.519])
                    .zoom(7)
                    .cluster(true)
                    .filterByArea(true)
                    //  .featureKeyAccessor(function(feature) {return feature.properties.geo; })
                    .renderPopup(true)
                    //  .popup(function(feature) { return feature.properties.sitear+" : "+feature.properties.neighbourhood; });
                       //sitear	neighbourhood	organisat	governorate	district	photo	environment	phone	household	men	women	boys	girls	individual
                      //.clusterObject({ maxClusterRadius: 40, disableClusteringAtZoom:10,spiderfyOnMaxZoom: false,showCoverageOnHover: false})
                    .popup();

            /* Customised infobox 
            d3.selectAll("g.row").call(rowTip);
            d3.selectAll("g.row").on('mouseover', rowTip.show).on('mouseout', rowTip.hide);

            d3.selectAll(".pie-slice").call(pieTip);
            d3.selectAll(".pie-slice").on('mouseover', pieTip.show).on('mouseout', pieTip.hide);
            */


            $('#reset').on('click', function (){
              dc.filterAll(groupname);
              dc.redrawAll(groupname);
              return false;
            })
            
            dc.renderAll(groupname);
     }

</script>

<script src="js/bootstrap.js"></script>

<div width="100%" style="background:#AAAAAA; height:25px" align=right>
    <span  class="demoTableRow">
        <font color="#FFFFFF">  Produced by Information Management Unit, UNHCR, Jordan. For more information please contact <a href="http://data.unhcr.org/jordan/team.html" target="_blank" >our team</a> or consult <a href="https://github.com/unhcr-jordan/vulnerability">Project Credits</a> </font>
    </span> &nbsp;&nbsp;&nbsp;
</div>

<script>
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

<div class="d3-tip n" style="position: absolute; display: none; box-sizing: border-box; top: 186.9px; left: 727.5px;"></div><div class="d3-tip" style="position: absolute; display: none; box-sizing: border-box;"></div>
</body>

</html>
